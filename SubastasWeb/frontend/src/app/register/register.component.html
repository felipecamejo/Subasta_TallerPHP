<section class="container mt-4">
  <h1>Registro</h1>

  <form [formGroup]="form" (ngSubmit)="onSubmit()" novalidate>

    <div class="mb-3">
      <label for="nombre" class="form-label">Nombre</label>
      <input type="text" id="nombre" class="form-control" formControlName="nombre">
      <div *ngIf="nombre?.touched && nombre?.invalid" class="text-danger">
        El nombre es obligatorio.
      </div>
    </div>

    <div class="mb-3">
      <label for="cedula" class="form-label">Cédula</label>
      <input type="text" id="cedula" class="form-control" formControlName="cedula">
      <div *ngIf="cedula?.touched && cedula?.invalid" class="text-danger">
        La cédula es obligatoria.
      </div>
    </div>

    <div class="mb-3">
      <label for="email" class="form-label">Correo electrónico</label>
      <input type="email" id="email" class="form-control" formControlName="email">
      <div *ngIf="email?.touched && email?.invalid" class="text-danger">
        Ingresa un email válido.
      </div>
    </div>

    <div class="mb-3">
      <label for="telefono" class="form-label">Teléfono</label>
      <input type="text" id="telefono" class="form-control" formControlName="telefono">
      <div *ngIf="telefono?.touched && telefono?.invalid" class="text-danger">
        El teléfono es obligatorio.
      </div>
    </div>

    <div class="mb-3">
      <label for="contrasenia" class="form-label">Contraseña</label>
      <input type="password" id="contrasenia" class="form-control" formControlName="contrasenia">
      <div *ngIf="contrasenia?.touched && contrasenia?.invalid" class="text-danger">
        La contraseña debe tener al menos 8 caracteres.
      </div>
    </div>

    <div class="mb-3">
      <label for="confirmarContrasenia" class="form-label">Confirmar contraseña</label>
      <input type="password" id="confirmarContrasenia" class="form-control" formControlName="confirmarContrasenia">
      <div *ngIf="confirmarContrasenia?.touched && confirmarContrasenia?.invalid" class="text-danger">
        La confirmación es obligatoria.
      </div>
      <div *ngIf="form.errors?.passwordsMismatch" class="text-danger">
        Las contraseñas no coinciden.
      </div>
    </div>

    <div class="mb-3">
      <label for="tipo" class="form-label">Rol</label>
      <select id="tipo" class="form-select" formControlName="tipo">
        <option value="cliente">Cliente</option>
        <option value="rematador">Rematador</option>
        <option value="casa_remate">Casa de Remate</option>
      </select>
    </div>

    <div class="mb-3" *ngIf="esRematador">
      <label for="matricula" class="form-label">Matrícula</label>
      <input type="text" id="matricula" class="form-control" formControlName="matricula">
      <div *ngIf="matricula?.touched && matricula?.invalid" class="text-danger">
        La matrícula es obligatoria para rematadores.
      </div>
    </div>

    <div class="mb-3" *ngIf="esCasaRemate">
      <label for="idFiscal" class="form-label">ID Fiscal</label>
      <input type="text" id="idFiscal" class="form-control" formControlName="idFiscal">
      <div *ngIf="idFiscal?.touched && idFiscal?.invalid" class="text-danger">
        El ID Fiscal es obligatorio para casas de remate.
      </div>
    </div>

    <div class="mb-3">
      <label class="form-label">Ubicación</label>
      <div id="map" style="height: 300px;"></div>
      <div *ngIf="latitud?.invalid || longitud?.invalid" class="text-danger mt-1">
        Hacé clic en el mapa para seleccionar tu ubicación.
      </div>
    </div>

    <div *ngIf="submissionError" class="alert alert-danger mt-3">
      {{ submissionError }}
    </div>

    <button class="btn btn-primary mt-3" type="submit" [disabled]="loading">
      {{ loading ? 'Registrando...' : 'Registrarse' }}
    </button>
  </form>
</section>
