<main class="w-full">
    <article class="w-full">
        <div class="w-full flex flex-wrap gap">
            <p class="titulo ">CasaRemate {{model.usuario?.nombre}}</p>
            <p-button label="Editar CasaRemate" class="boton" severity="secondary"/>
        </div>
        <div class="w-full">
            <p>Rut: {{model.idFiscal}}</p>
            <p>Email: {{model.usuario?.email}}</p>
            <p>Telefono: {{model.usuario?.telefono}}</p>
            <p>Telefono: {{model.usuario?.telefono}}</p>
            <form [formGroup]="estrellas">
              <p-rating formControlName="value" [readonly]="true"></p-rating>
            </form>
        </div>
        <div class="w-full flex flex-wrap gap">
            <p-button label="Crear Subasta" class="boton" severity="secondary" (click)="mostrarSubasta()"/>
            <p-dialog header="Añadir nuevo cliente a credito" [modal]="true" [(visible)]="modalSubasta" [style]="{ width: '25rem' }">
              <div class="flex items-center gap-4 mb-4">
                <label for="username" class="font-semibold w-24 modal">Nombre</label>
                <input pInputText class="flex-auto modal" autocomplete="off" />
              </div>
              <div class="flex items-center gap-4 mb-4">
                <label for="telefono" class="font-semibold w-24 modal">Telefono</label>
                <input pInputText class="flex-auto modal" autocomplete="off" />
              </div>
              <div class="flex items-center gap-4 mb-4">
                <label for="min" class="font-semibold w-24 modal">Min</label>
                <input pInputTex class="flex-auto modal" autocomplete="off" type="number" />
              </div>
              <div class="flex items-center gap-4 mb-4">
                <label for="max" class="font-semibold w-24 modal">Max</label>
                <input pInputText class="flex-auto modal" autocomplete="off" type="number"/>
              </div>
              <div class="flex items-center gap-4 mb-4">
                <label for="deuda" class="font-semibold w-24 modal">Deuda</label>
                <input pInputText class="flex-auto modal" autocomplete="off" type="number" />
              </div>
              <div class="flex items-center gap-4 mb-4">
                <label for="pago" class="font-semibold w-24 modal">Pago</label>
                <input pInputText class="flex-auto modal"  autocomplete="off" type="number"/>
              </div>
              <div class="flex justify-end gap-2">
                <p-button label="Confirmar" severity="secondary" (click)="saveSubasta()" />
              </div>
            </p-dialog>
            <p-button label="Crear Articulo" class="boton" severity="secondary" (click)="mostrarArticulo()"/>
            <p-dialog header="Añadir nuevo cliente a credito" [modal]="true" [(visible)]="modalSubasta" [style]="{ width: '25rem' }">
              <div class="flex items-center gap-4 mb-4">
                <label for="username" class="font-semibold w-24 modal">Nombre</label>
                <input pInputText class="flex-auto modal" autocomplete="off" />
              </div>
              <div class="flex items-center gap-4 mb-4">
                <label for="telefono" class="font-semibold w-24 modal">Telefono</label>
                <input pInputText class="flex-auto modal" autocomplete="off" />
              </div>
              <div class="flex items-center gap-4 mb-4">
                <label for="min" class="font-semibold w-24 modal">Min</label>
                <input pInputTex class="flex-auto modal" autocomplete="off" type="number" />
              </div>
              <div class="flex items-center gap-4 mb-4">
                <label for="max" class="font-semibold w-24 modal">Max</label>
                <input pInputText class="flex-auto modal" autocomplete="off" type="number"/>
              </div>
              <div class="flex items-center gap-4 mb-4">
                <label for="deuda" class="font-semibold w-24 modal">Deuda</label>
                <input pInputText class="flex-auto modal" autocomplete="off" type="number" />
              </div>
              <div class="flex items-center gap-4 mb-4">
                <label for="pago" class="font-semibold w-24 modal">Pago</label>
                <input pInputText class="flex-auto modal"  autocomplete="off" type="number"/>
              </div>
              <div class="flex justify-end gap-2">
                <p-button label="Confirmar" severity="secondary" (click)="saveArticulo()" />
              </div>
            </p-dialog>
        </div>
    </article>
    <article class="w-full">
        <p class="tituloCentrado w-full">Articulos</p>
        <p-table
        class="texto"
        [value]="lalala || []"
        showGridlines
        [paginator]="true"
        [rows]="5"
        [totalRecords]="totalRecords"
        [rowsPerPageOptions]="[5, 10, 20]"
        paginatorPosition="bottom"
        currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} compras"
        >

      <ng-template pTemplate="header">
        <tr>
          <th>Nombre</th>
          <th>Fecha</th>
          <th>Duración (min)</th>
          <th>Estado</th>
          <th>Rematador</th>
          <th>Lotes</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-lelo>
        <tr>
          <td>{{ subasta.nombre }}</td>
          <td>{{ subasta.fecha | date:'dd/MM/yyyy HH:mm' }}</td>
          <td>{{ subasta.duracionMinutos }}</td>
          <td>
            <span [class]="subasta.activa ? 'text-green-600 font-semibold' : 'text-red-600 font-semibold'">
              {{ subasta.activa ? 'Activa' : 'Inactiva' }}
            </span>
          </td>
          <td>{{ subasta.rematador?.usuario?.nombre || 'Sin asignar' }}</td>
          <td>{{ subasta.lotes?.length || 0 }}</td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="7" class="text-center">No hay subastas registradas</td>
        </tr>
      </ng-template>
    </p-table>
    </article>

    <!-- SECCIÓN DE LOTES -->
    <article class="w-full">
        <p class="tituloCentrado w-full">Lotes de la Casa de Remate</p>
        <div *ngIf="cargandoDatos" class="flex justify-content-center p-4">
            <i class="pi pi-spin pi-spinner" style="font-size: 2rem"></i>
            <span class="ml-2">Cargando lotes...</span>
        </div>
        <p-table
        *ngIf="!cargandoDatos"
        class="texto"
        [value]="lotes"
        showGridlines
        [paginator]="true"
        [rows]="5"
        [totalRecords]="lotes.length"
        [rowsPerPageOptions]="[5, 10, 20]"
        paginatorPosition="bottom"
        currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} lotes"
        >

      <ng-template pTemplate="header">
        <tr>
          <th>ID Lote</th>
          <th>Subasta</th>
          <th>Valor Base</th>
          <th>Puja Mínima</th>
          <th>Umbral</th>
          <th>Estado Pago</th>
          <th>Artículos</th>
          <th>Pujas</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-lote>
        <tr>
          <td>{{ lote.id }}</td>
          <td>{{ lote.subasta?.nombre || 'Sin subasta' }}</td>
          <td>${{ lote.valorBase | number:'1.2-2' }}</td>
          <td>${{ lote.pujaMinima | number:'1.2-2' }}</td>
          <td>${{ lote.umbral | number:'1.2-2' }}</td>
          <td>
            <span [class]="lote.pago ? 'text-green-600 font-semibold' : 'text-red-600 font-semibold'">
              {{ lote.pago ? 'Pagado' : 'Pendiente' }}
            </span>
          </td>
          <td>{{ lote.articulos?.length || 0 }}</td>
          <td>{{ lote.pujas?.length || 0 }}</td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="9" class="text-center">No hay lotes registrados</td>
        </tr>
      </ng-template>
    </p-table>
    </article>
</main>
