<main class="w-full flex flex-wrap">
    <article class="article-1 col-12 md:col-6 flex">
        <iframe class="video-player-1" 
            *ngIf="videoUrl && videoUrl !== null; else noVideo"
            [src]="videoUrl"
            frameborder="0"
            allowfullscreen
            loading="lazy"
            title="Stream de la Subasta"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture">
        </iframe>
        <ng-template #noVideo>
            <div class="no-video-placeholder">
                <p>Stream no disponible</p>
                <p>ID de video actual: {{ subasta?.videoId || 'No configurado' }}</p>
                <input type="text" class="text-input" pInputText [(ngModel)]="video" placeholder="Ingrese ID del video" />
                <p-button label="Cargar Video" severity="secondary" (click)="initializeVideo(video)"/>
            </div>
        </ng-template>
    </article>
    <article class="article-1 col-12 md:col-6 paddingArticle" *ngIf="subasta">
        <div class="w-full flex padreTituloReloj">
            <h1 class="titulo"> {{ subasta.nombre }} </h1>
            <div class="clock-input-group">
                <span class="pi pi-clock"></span>
                <input type="text" [class]="timerCssClass" pInputText [value]="timerDisplayText" readonly />
            </div>
        </div>

        <hr class="w-full" />
        <div class="w-full subDiv" >
            <div class="botones-navegacion" *ngIf="isRematador()" style="display: flex;">
                <p-button label="Anterior lote" severity="secondary" class="nav-btn" [disabled]="!puedeNavegerLotes" (click)="anteriorLote()" [style]="{'width': 'auto'}"/>
                <p-button label="Siguiente lote" severity="secondary" class="nav-btn" [disabled]="!puedeNavegerLotes" (click)="siguienteLote()" [style]="{'width': 'auto'}"/>
            </div>
            
            <div class="w-full flex padrePujas margin">
                <div class="puja-input-group">
                     <span class="subtitulo">Puja Actual:</span>
                <input type="text" class="text-input" [value]="pujaActual" pInputText readonly/>
                </div>
            </div>

            <div class="w-full margin" *ngIf="!isRematador()">
                <div class="w-full flex padrePujas">
                    <div class="botones-puja">
                        <p-button label="Puja Rápida" severity="secondary" class="puja-btn" [disabled]="!this.timerState.timerActivo" (click)="crearPujaRapida()"/>
                        <input type="number" class="text-input" [disabled]="!this.timerState.timerActivo" [value]="pujaActual+1"  pInputText readonly/>
                    </div>
                </div>

                <div class="w-full flex padrePujas margin">
                    <div class="puja-input-group">
                        <p-button label="Puja" severity="secondary" class="puja-custom-btn" [disabled]="!this.timerState.timerActivo" (click)="crearPujaComun()"/>
                        <input type="number" class="text-input"  [disabled]="!this.timerState.timerActivo" [(ngModel)]="pujaComun" pInputText  />
                    </div>
                </div>
            </div>
        </div>

        <!-- Mensaje de ganador (solo se muestra cuando la subasta termina) -->
        <div class="winner-notification" *ngIf="esGanador && !pagando">
            <div class="alert alert-success">
                <i class="pi pi-trophy"></i>
                <strong>¡Felicidades!</strong> Has ganado la subasta con una puja de <strong>${{pujaActual}}</strong>
                <p>El pago se procesará automáticamente.</p>
            </div>
        </div>

        <p-dialog 
            header="🏆 ¡Subasta Ganada! - Método de Pago" 
            [(visible)]="pagando" 
            [modal]="true" 
            [closable]="true"
            [draggable]="false"
            [resizable]="false"
            [closeOnEscape]="false"
            [dismissableMask]="false"
            [style]="{width: '90vw', maxWidth: '600px', minHeight: '400px'}"
            styleClass="payment-modal">

            <section class="payment-section">
                <h3>🎉 ¡Felicidades! Has ganado la subasta</h3>
                <p>Has ganado el <strong>Lote {{indexLotes + 1}}</strong> con una puja de <strong>${{paypalMonto}}</strong></p>
                <p>Por favor, procede con el pago para completar la transacción:</p>
                <div class="payment-container">
                    <app-paypal 
                        [amount]="paypalMonto"
                        (paymentSuccess)="onPaymentSuccess($event)"
                        (paymentError)="onPaymentError($event)">
                    </app-paypal> 
                </div>
                <div class="payment-info">
                    <p><small>💬 Después del pago, se creará automáticamente un chat con la casa de remate para coordinar la entrega.</small></p>
                </div>
            </section>
        </p-dialog>

        <!-- Chat Toggle Button para mostrar después del pago -->
        <div class="chat-section" *ngIf="chatCreado">
            <div class="alert alert-info">
                <i class="pi pi-check-circle"></i>
                <strong>Chat creado exitosamente!</strong> Se ha establecido comunicación con la casa de remate.
            </div>
            <p-button 
                label="Abrir Chat con Casa de Remate" 
                icon="pi pi-comments" 
                severity="secondary"
                class="chat-toggle-button"
                (click)="abrirChatEnNuevaPestana()">
            </p-button>
        </div>
        
    </article>
</main>



